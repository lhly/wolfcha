# 猹杀 (Wolfcha) 项目访谈 Q&A

以下文档基于项目代码库现状整理，旨在回答关于 Wolfcha-猹杀项目的设计理念、技术实现及未来规划等问题。

## 1. 核心玩法与游戏节奏

**Wolfcha-猹杀** 是一款结合了 **"双层 AI 扮演"** 机制的在线狼人杀游戏。

*   **核心体验**：玩家在一个 10 人局的标准配置中（3 狼人、4 平民、1 预言家、1 女巫、1 猎人、1 守卫），与 9 个由大语言模型（LLM）驱动的 AI 玩家同台竞技。
*   **双层扮演**：每个 AI 不仅扮演狼人杀中的功能角色（如"预言家"），还扮演一个具有特定性格（如"傲娇"、"鲁莽"）的"虚拟玩家"。
*   **游戏节奏**：
    *   **夜晚**：狼人刀人、女巫用药、预言家查验、守卫守护。所有行动通过 AI 决策并行或串行处理，节奏较快。
    *   **白天**：包含警长竞选（可跳过）、轮流发言、自由讨论（PK 环节）和投票放逐。这是游戏的重头戏，AI 会根据场上局势进行长文本逻辑推理和伪装。
*   **主要乐趣**：除了传统的推理快感，我们希望用户获得 **"赛博斗蛐蛐"** 的乐趣——观察不同模型（如 DeepSeek、Claude、Qwen）在复杂博弈下的智力表现和拟人化反应。

## 2. 团队构成与分工

我们是来自 **"Oil Oil"** 组织的开源团队，主要由以下角色构成：

*   **全栈开发 (Full Stack)**：负责 Next.js (App Router) 架构搭建、状态机 (`GameMachine`) 设计、实时交互逻辑以及后端 API (Supabase/Stripe) 的实现。
*   **AI 工程师 (AI Engineer)**：负责 Prompt Engineering（提示词工程）、模型微调、ZenMux 接口对接以及 AI 性格与技能系统的设计。
*   **产品与设计 (PM & Design)**：负责游戏机制的取舍（如 10 人局板子）、UI/UX 设计（复古像素/Notion 风格）以及整体美术素材的统筹。

## 3. 黑客松 48 小时复盘

在「观猹 + 魔搭 环球黑客松」的 48 小时极限开发中，我们的时间线大致如下：

*   **0-12h (选题与核心)**：确立"全 AI 狼人杀"选题。完成核心状态机 (`GameMachine`) 的设计，跑通了"发牌 -> 夜晚行动 -> 白天发言 -> 投票"的最小闭环。
    *   *取舍*：放弃了复杂的 Socket 实时通信，采用轮询/流式响应的轻量级方案。
*   **12-24h (AI 接入与扮演)**：对接 ZenMux 聚合 API，编写第一版 System Prompt。
    *   *取舍*：发现让 AI 同时理解"游戏规则"和"伪装策略"很难，于是确立了 **"双层 Prompt"** 结构（一层规则，一层人设）。
*   **24-36h (UI 铺设与音频)**：接入 MiniMax TTS 实现旁白语音，设计复古 UI 界面，实现口型同步 (`Lip Sync`) 动效。
    *   *取舍*：放弃了复杂的 3D 场景，专注于 2D 平面交互和文字体验。
*   **36-48h (调试与上线)**：解决"无限死循环"、"AI 幻觉"等恶性 Bug，部署上线。
    *   *取舍*：砍掉了"观战模式"和"自定义板子"，只保留最稳定的 10 人局。

## 4. 灵感来源与选题原因

*   **灵感**：项目名 **"Wolfcha"** 取自 Wolf (狼) + Cha (猹/Watch)，致敬"闰土刺猹"的梗，也寓意"围观 AI 互啄"。
*   **切入点选择**：
    *   **高文本密度**：狼人杀本质是"语言游戏"，是 LLM 最擅长的领域。
    *   **逻辑与伪装**：相比于 UNO 或大富翁，狼人杀需要"说谎"和"推理"，这是测试大模型智商（IQ）和情商（EQ）的绝佳场景。
    *   **社交痛点**：现实中凑齐 10 个人玩狼人杀太难，"随时随地能开局"是刚需。

## 5. 独特体验：玩游戏 vs 看戏

目前的猹杀更偏向 **"我在和一群拟人化的 AI 玩游戏"**，但长期来看，我们希望它向 **"大模型演戏/赛博斗蛐蛐"** 靠拢。

*   **独特体验**：最有趣的点往往不是"我赢了"，而是"那个 DeepSeek 扮演的狼人居然骗过了 Claude 扮演的女巫"。
*   **未来定位**：打造一个 **Model Arena (模型竞技场)**。不仅是玩家玩，更是不同厂商模型的"智力阅兵"。

## 6. 内置大模型与差异

目前游戏通过 ZenMux 接入了多款主流模型：
*   **DeepSeek V3**：逻辑缜密，攻击性强，适合扮演"悍跳狼"或"高配玩家"。
*   **Qwen (通义千问)**：指令遵循好，发言稳健，适合"预言家"或"守卫"。
*   **Gemini 3 Flash**：反应快，偶尔会有意想不到的"脑洞"发言。
*   **Kimi K2**：长文本理解能力强，适合盘复盘逻辑。

**差异**：在高压博弈下，逻辑能力弱的模型容易"聊爆"（自相矛盾），而强模型则能通过"倒钩"、"阴阳怪气"等高级战术获胜。

## 7. 公平性与一致性控制

为了保证多模型混战的公平性：
1.  **统一上下文 (Context)**：`PhaseManager` 会为所有模型构建完全一致的 `GameContext`（包括历史发言摘要、当前局势、剩余人数），确保信息对称。
2.  **Prompt 结构标准化**：所有模型使用相同的 Prompt 模板结构（System Rules + Role Know-how + Situational Strategy），仅在"Persona"字段有差异。
3.  **温度控制**：全局 `Temperature` 设定为 `0.7`，在创造性与逻辑稳定性之间寻找平衡。
4.  **幻觉抑制**：通过 `ai-json-fixer` 和后处理脚本，强制修正模型输出的格式错误，确保存活状态和技能使用符合规则。

## 8. 拟人化：拒绝"AI 味"

让 NPC 像活人，我们做了以下努力：
*   **性格注入 (Persona Injection)**：在 Prompt 中明确写入"你是一个暴躁的老大爷"或"你是一个胆小的二次元少女"，并强制要求"不要使用教科书式的语言"。
*   **口语化指令**：要求 AI 使用"断句"、"语气词"（如“呃...”、“那个...”），并允许出现逻辑漏洞（模拟人类的失误）。
*   **动态口型**：前端根据语音音量实时驱动头像嘴巴开合，配合眨眼动画，增加临场感。
*   **策略多样性**：在 `ai-skill-system` 中设计了"技能"，允许 AI 随机触发"悍跳"、"划水"等非理性行为，而不是永远追求最优解。

## 9. AI 辅助开发 (AI Native Dev)

作为一个 AI 原生项目，我们在开发全流程都大量使用了 AI：
*   **编码**：**Cursor / Windsurf** 是主力 IDE，辅助生成了大量 React 组件 (`src/components/game`) 和状态机逻辑。
*   **Prompt 调优**：使用 LLM 自身来优化 System Prompt，让 AI "教" AI 如何玩狼人杀。
*   **音频**：使用 **MiniMax** 生成了多语言（中/英）的高质量旁白语音。
*   **美术**：角色立绘使用了 **OpenCreator** 等工具生成，头像使用了 **DiceBear** API。
*   **数据处理**：使用 `ai-json-fixer` 库处理 LLM 不稳定的 JSON 输出。

## 10. 法官/观战模式

这是一个已经在规划中的功能（见 `DevTools` 和 `Settings` 中的 `SpectatorMode` 痕迹）。
*   **设想**：玩家可以作为"上帝"视角，完全不干预游戏，只看 10 个 AI 互打。
*   **复盘报告**：我们在设计文档 (`post-game-analysis-design.md`) 中规划了详细的 **赛后复盘** 功能，包括 MVP 评选、高光时刻（金句）截取以及 AI 之间的互评（"吐槽"）。

## 11. 成本与商业化

*   **成本压力**：一局 10 人局游戏，涉及数十次长文本推理，Token 消耗巨大。尤其是使用高智商模型（如 DeepSeek V3）时，成本不容忽视。
*   **商业化方案**：
    *   **积分制 (Credits)**：目前已实现了基于 Stripe 的充值系统和 Referral（邀请码）机制。
    *   **每日奖励**：提供每日免费积分，保证轻度玩家体验。
    *   **BYOK (Bring Your Own Key)**：允许硬核玩家填入自己的 API Key (ZenMux/Dashscope) 来解锁无限畅玩。

## 12. 评分逆跌 (4.9 -> 7.5) 的背后

评分的低开高走主要归功于：
1.  **稳定性提升**：黑客松版本存在大量"卡死"、"无限发言"的 Bug，后续通过重构 `useGameLogic` 和 `PhaseManager` 解决了大部分稳定性问题。
2.  **模型智商升级**：随着接入更强的模型（如 DeepSeek V3），AI 的逻辑不再"弱智"，玩家从"看傻子"变成了"被套路"，游戏体验质变。
3.  **体验打磨**：增加了移动端适配、倍速播放、跳过发言等便利功能，尊重了用户的时间。
4.  **持续开源**：社区看到了团队的持续维护和 Feature 更新，给出了鼓励分。
